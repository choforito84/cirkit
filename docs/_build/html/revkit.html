

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>RevKit &mdash; CirKit  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="CirKit  documentation" href="index.html"/>
        <link rel="prev" title="Integration" href="integration.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> CirKit
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_structures.html">Data Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="integration.html">Integration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">RevKit</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-command-to-revkit">Adding a command to RevKit</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#exercises">Exercises</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CirKit</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>RevKit</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/revkit.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="revkit">
<h1>RevKit<a class="headerlink" href="#revkit" title="Permalink to this headline">¶</a></h1>
<p>This page lists some RevKit specific documentation.</p>
<div class="section" id="adding-a-command-to-revkit">
<h2>Adding a command to RevKit<a class="headerlink" href="#adding-a-command-to-revkit" title="Permalink to this headline">¶</a></h2>
<p>This tutorial explains how to integrate a new simple command into
RevKit. As an example, a command called <cite>unopt</cite> is implemented, that
copies gate in a reversible circuit without modifying the
functionality.</p>
<p>CirKit provides utility scripts in order to create new files
easily. We create a file for the new command using the following
script:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">utils</span><span class="o">/</span><span class="n">make_src_file</span><span class="o">.</span><span class="n">py</span> <span class="n">cli</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">unopt</span> <span class="n">reversible</span>
</pre></div>
</div>
<p>Note, that the first argument is the path to the filename without the
<em>src/</em> in the beginning and without an extension in the end. Two
files, a header and a source file, are created. The second parameter
ensures that the files are created for the RevKit add-on. The third
parameter is optional and can have a name of the file author. If not
specified, the name is fetched from the user’s git configuration.</p>
<p>The header file in
<em>addons/cirkit-addon-reversible/src/cli/commands/unopt.hpp</em> contains
already some skeleton code and we extend it as follows (all comments
are omitted in the code):</p>
<div class="highlight-c++"><div class="highlight"><pre><span></span><span class="c1">// unopt.hpp</span>
<span class="cp">#ifndef CLI_UNOPT_COMMAND_HPP</span>
<span class="cp">#define CLI_UNOPT_COMMAND_HPP</span>

<span class="cp">#include</span> <span class="cpf">&lt;cli/cirkit_command.hpp&gt;</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">cirkit</span>
<span class="p">{</span>

<span class="k">class</span> <span class="nc">unopt_command</span> <span class="o">:</span> <span class="k">public</span> <span class="n">cirkit_command</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">unopt_command</span><span class="p">(</span> <span class="k">const</span> <span class="n">environment</span><span class="o">::</span><span class="n">ptr</span><span class="o">&amp;</span> <span class="n">env</span> <span class="p">);</span>
  <span class="n">rules_t</span> <span class="nf">validity_rules</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

<span class="k">protected</span><span class="o">:</span>
  <span class="kt">bool</span> <span class="n">execute</span><span class="p">();</span>

<span class="k">private</span><span class="o">:</span>
  <span class="kt">unsigned</span> <span class="n">copies</span> <span class="o">=</span> <span class="mi">1u</span><span class="p">;</span>
<span class="p">};</span>

<span class="p">}</span>

<span class="cp">#endif</span>
</pre></div>
</div>
<p>We define a command with the base class <code class="docutils literal"><span class="pre">cirkit_command</span></code>. It is
important that the class name is <code class="docutils literal"><span class="pre">unopt_command</span></code> to be used in later
code that makes use of macros and relies on some naming
conventions. Two methods need to be implemented, the constructor that
will set up the arguments which can be passed to the command, and
<code class="docutils literal"><span class="pre">execute</span></code> which executes the code and calls our algorithm. We also
implement the method <code class="docutils literal"><span class="pre">validity_rules</span></code> to ensure that the store
contains at least one reversible circuit when calling the
command. More details on how to write commands can be found in the
<a class="reference external" href="https://github.com/msoeken/cirkit/blob/master/programs/core/abc_cli.cpp">abc_cli</a> example program.</p>
<div class="highlight-c++"><div class="highlight"><pre><span></span><span class="c1">// unopt.cpp</span>
<span class="cp">#include</span> <span class="cpf">&quot;unopt.hpp&quot;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&lt;alice/rules.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cli/reversible_stores.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;core/utils/program_options.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;reversible/target_tags.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;reversible/functions/copy_metadata.hpp&gt;</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">cirkit</span>
<span class="p">{</span>

<span class="n">unopt_command</span><span class="o">::</span><span class="n">unopt_command</span><span class="p">(</span> <span class="k">const</span> <span class="n">environment</span><span class="o">::</span><span class="n">ptr</span><span class="o">&amp;</span> <span class="n">env</span> <span class="p">)</span>
  <span class="o">:</span> <span class="n">cirkit_command</span><span class="p">(</span> <span class="n">env</span><span class="p">,</span> <span class="s">&quot;unoptimize circuits&quot;</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="n">opts</span><span class="p">.</span><span class="n">add_options</span><span class="p">()</span>
    <span class="p">(</span> <span class="s">&quot;copies,c&quot;</span><span class="p">,</span> <span class="n">value_with_default</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">copies</span> <span class="p">),</span> <span class="s">&quot;number of gate copies&quot;</span> <span class="p">)</span>
    <span class="p">;</span>

  <span class="n">add_new_option</span><span class="p">();</span> <span class="cm">/* adds a flag --new, or -n that can be used to add a new</span>
<span class="cm">                       store entry instead of overwriting it */</span>
<span class="p">}</span>

<span class="n">command</span><span class="o">::</span><span class="n">rules_t</span> <span class="n">unopt_command</span><span class="o">::</span><span class="n">validity_rules</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span><span class="n">has_store_element</span><span class="o">&lt;</span><span class="n">circuit</span><span class="o">&gt;</span><span class="p">(</span> <span class="n">env</span> <span class="p">)};</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">unopt_command</span><span class="o">::</span><span class="n">execute</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">auto</span><span class="o">&amp;</span> <span class="n">circuits</span> <span class="o">=</span> <span class="n">env</span><span class="o">-&gt;</span><span class="n">store</span><span class="o">&lt;</span><span class="n">circuit</span><span class="o">&gt;</span><span class="p">();</span> <span class="cm">/* access store with reversible circuits */</span>

  <span class="cm">/* reference to current circuit, and new circuit with same properties */</span>
  <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">circ</span> <span class="o">=</span> <span class="n">circuits</span><span class="p">.</span><span class="n">current</span><span class="p">();</span>
  <span class="n">circuit</span> <span class="n">circ_new</span><span class="p">;</span>
  <span class="n">copy_metadata</span><span class="p">(</span> <span class="n">circ</span><span class="p">,</span> <span class="n">circ_new</span> <span class="p">);</span>

  <span class="k">for</span> <span class="p">(</span> <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">g</span> <span class="p">:</span> <span class="n">circ</span> <span class="p">)</span>     <span class="cm">/* iterate through the gates */</span>
  <span class="p">{</span>
    <span class="n">circ_new</span><span class="p">.</span><span class="n">append_gate</span><span class="p">()</span> <span class="o">=</span> <span class="n">g</span><span class="p">;</span>    <span class="cm">/* copy existing gate */</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">is_toffoli</span><span class="p">(</span> <span class="n">g</span> <span class="p">)</span> <span class="p">)</span>         <span class="cm">/* some more copies, if gate is Toffoli */</span>
    <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span> <span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0u</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2u</span> <span class="o">*</span> <span class="n">copies</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="n">circ_new</span><span class="p">.</span><span class="n">append_gate</span><span class="p">()</span> <span class="o">=</span> <span class="n">g</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">extend_if_new</span><span class="p">(</span> <span class="n">circuits</span> <span class="p">);</span> <span class="cm">/* extend store by empty element if --new option is set */</span>
  <span class="n">circuits</span><span class="p">.</span><span class="n">current</span><span class="p">()</span> <span class="o">=</span> <span class="n">circ_new</span><span class="p">;</span>

  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span> <span class="cm">/* always return true */</span>
<span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>The function should always return <code class="docutils literal"><span class="pre">true</span></code>.</p>
<p>We are almost done. Next, we add the command to the RevKit
executable. For this purpose, open the file
<em>addons/cirkit-addon-reversible/programs/reversible/revkit.cpp</em> and
add the following header, where other headers are included:</p>
<div class="highlight-c++"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;cli/commands/unopt.hpp&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>And then add the command in the same style as other commands are added using:</p>
<div class="highlight-c++"><div class="highlight"><pre><span></span><span class="n">ADD_COMMAND</span><span class="p">(</span> <span class="n">unopt</span> <span class="p">);</span>
</pre></div>
</div>
<p>That’s it. We rebuild RevKit with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="o">-</span><span class="n">C</span> <span class="n">build</span> <span class="n">revkit</span>
</pre></div>
</div>
<p>and then call it to try out the new command:</p>
<div class="highlight-cirkit"><div class="highlight"><pre><span></span><span class="na">revkit&gt;</span> <span class="ni">read_spec</span> -p &quot;0 4 2 1 0 3 7 5&quot;
<span class="na">revkit&gt;</span> <span class="ni">tbs</span>
[i] run-time: 0.00 secs
<span class="na">revkit&gt;</span> <span class="ni">ps</span> -c
Lines:        3
Gates:        7
T-count:      21
Logic qubits: 4
<span class="na">revkit&gt;</span> <span class="ni">unopt</span>
<span class="na">revkit&gt;</span> <span class="ni">ps</span> -c
Lines:        3
Gates:        21
T-count:      63
Logic qubits: 4
</pre></div>
</div>
<div class="section" id="exercises">
<h3>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h3>
<p>Here are some suggestions for exercises (with a difficulty estimation from 0–50) to extend the add-on.</p>
<ol class="arabic simple">
<li>[25] Copy all gates which are self-inverse in this manner based on a syntactic comparison.</li>
</ol>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="integration.html" class="btn btn-neutral" title="Integration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Mathias Soeken.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>